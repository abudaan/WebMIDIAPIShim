{"version":3,"sources":["../../src/util/jzz.js"],"names":["MIDI","arg","self","_from","slice","arguments","length","arr","Array","i","n","push","prototype","constructor","_stamp","obj","_orig","_unstamp","indexOf","splice","_stamped","createJzz","_version","_R","_ready","_queue","_err","_exec","x","shift","_bad","_hope","_or","apply","_push","func","_slip","unshift","_pause","_resume","_break","err","_repair","_crash","_clone","_wait","delay","setTimeout","wait","F","ret","_and","q","Function","console","log","and","or","_info","info","engine","sysex","name","_close","close","_tryAny","e","toString","_pop","_J","time","performance","now","_time","_initTimer","Date","_startTime","key","val","Object","k","hasOwnProperty","ver","version","_outs","_ins","_postRefresh","_engine","_type","_sysex","inputs","outputs","_allOuts","_allIns","manufacturer","_virtual","type","_refresh","refresh","_filterList","a","RegExp","test","_notFound","port","msg","_openMidiOut","pack","_openOut","openMidiOut","_M","_openMidiIn","_openIn","openMidiIn","_handles","_receive","_emit","send","note","c","v","t","noteOn","noteOff","m","emit","_connect","_disconnect","connect","disconnect","_jzz","_tryNODE","module","exports","_initNode","require","_tryJazzPlugin","div","document","createElement","style","visibility","body","appendChild","width","height","classid","isJazz","_initJazzPlugin","_tryCRX","inst","eventHandle","getElementById","JSON","parse","innerText","removeEventListener","_initCRX","addEventListener","dispatchEvent","Event","window","_zeroBreak","_filterEngines","opt","_filterEngineNames","_initNONE","web","dup","none","etc","head","tail","toLowerCase","concat","_initJZZ","_options","_initEngineJP","_inArr","_outArr","_inMap","_outMap","_main","MidiOutInfo","MidiInInfo","impl","_pool","_newPlugin","clients","_closeOut","plugin","MidiOutRaw","open","s","MidiOutOpen","MidiOutClose","_impl","_closeIn","handle","makeHandle","onmidi","MidiInOpen","MidiInClose","Time","plg","undefined","_msg","id","ready","CustomEvent","detail","_start","output","input","split","ins","j","outs","JZZ"],"mappings":"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","file":"jzz.js","sourcesContent":["/*\n    This is an adapted and abbreviated version of JZZ by Sema: https://github.com/jazz-soft/JZZ\n*/\n\nfunction MIDI(arg) {\n    var self = this instanceof MIDI ? this : self = new MIDI();\n    self._from = arg instanceof MIDI ? arg._from.slice() : [];\n    if (!arguments.length) return self;\n    var arr = arg instanceof Array ? arg : arguments;\n    for (var i = 0; i < arr.length; i++) {\n        var n = arr[i];\n        self.push(n);\n    }\n    return self;\n}\n\nMIDI.prototype = [];\nMIDI.prototype.constructor = MIDI;\nMIDI.prototype._stamp = function (obj) { this._from.push(obj._orig ? obj._orig : obj); return this; }\nMIDI.prototype._unstamp = function (obj) {\n    if (typeof obj == 'undefined') this._from = [];\n    else {\n        if (obj._orig) obj = obj._orig;\n        var i = this._from.indexOf(obj);\n        if (i > -1) this._from.splice(i, 1);\n    }\n    return this;\n}\nMIDI.prototype._stamped = function (obj) {\n    if (obj._orig) obj = obj._orig;\n    for (var i = 0; i < this._from.length; i++) if (this._from[i] == obj) return true;\n    return false;\n}\n\nfunction createJzz() {\n    var _version = '0.4.1';\n\n    // _R: common root for all async objects\n    function _R() {\n        this._orig = this;\n        this._ready = false;\n        this._queue = [];\n        this._err = [];\n    }\n    _R.prototype._exec = function () {\n        while (this._ready && this._queue.length) {\n            var x = this._queue.shift();\n            if (this._orig._bad) {\n                if (this._orig._hope && x[0] == _or) {\n                    this._orig._hope = false;\n                    x[0].apply(this, x[1]);\n                }\n                else {\n                    this._queue = [];\n                    this._orig._hope = false;\n                }\n            }\n            else if (x[0] != _or) {\n                x[0].apply(this, x[1]);\n            }\n        }\n    }\n    _R.prototype._push = function (func, arg) { this._queue.push([func, arg]); _R.prototype._exec.apply(this); }\n    _R.prototype._slip = function (func, arg) { this._queue.unshift([func, arg]); }\n    _R.prototype._pause = function () { this._ready = false; }\n    _R.prototype._resume = function () { this._ready = true; _R.prototype._exec.apply(this); }\n    _R.prototype._break = function (err) { this._orig._bad = true; this._orig._hope = true; if (err) this._orig._err.push(err); }\n    _R.prototype._repair = function () { this._orig._bad = false; }\n    _R.prototype._crash = function (err) { this._break(err); this._resume(); }\n    _R.prototype.err = function () { return _clone(this._err); }\n\n    function _wait(obj, delay) { setTimeout(function () { obj._resume(); }, delay); }\n    _R.prototype.wait = function (delay) {\n        if (!delay) return this;\n        function F() { } F.prototype = this._orig;\n        var ret = new F();\n        ret._ready = false;\n        ret._queue = [];\n        this._push(_wait, [ret, delay]);\n        return ret;\n    }\n\n    function _and(q) { if (q instanceof Function) q.apply(this); else console.log(q); }\n    _R.prototype.and = function (func) { this._push(_and, [func]); return this; }\n    function _or(q) { if (q instanceof Function) q.apply(this); else console.log(q); }\n    _R.prototype.or = function (func) { this._push(_or, [func]); return this; }\n\n    _R.prototype._info = {};\n    _R.prototype.info = function () {\n        var info = _clone(this._orig._info);\n        if (typeof info.engine == 'undefined') info.engine = 'none';\n        if (typeof info.sysex == 'undefined') info.sysex = true;\n        return info;\n    }\n    _R.prototype.name = function () { return this.info().name; }\n\n    function _close(obj) {\n        this._break('closed');\n        obj._resume();\n    }\n    _R.prototype.close = function () {\n        var ret = new _R();\n        if (this._close) this._push(this._close, []);\n        this._push(_close, [ret]);\n        return ret;\n    }\n\n    function _tryAny(arr) {\n        if (!arr.length) {\n            this._break();\n            return;\n        }\n        var func = arr.shift();\n        if (arr.length) {\n            var self = this;\n            this._slip(_or, [function () { _tryAny.apply(self, [arr]); }]);\n        }\n        try {\n            this._repair();\n            func.apply(this);\n        }\n        catch (e) {\n            this._break(e.toString());\n        }\n    }\n\n    function _push(arr, obj) {\n        for (var i = 0; i < arr.length; i++) if (arr[i] === obj) return;\n        arr.push(obj);\n    }\n    function _pop(arr, obj) {\n        for (var i = 0; i < arr.length; i++) if (arr[i] === obj) {\n            arr.splice(i, 1);\n            return;\n        }\n    }\n\n    // _J: JZZ object\n    function _J() {\n        _R.apply(this);\n    }\n    _J.prototype = new _R();\n\n    _J.prototype.time = function () { return 0; }\n    if (typeof performance != 'undefined' && performance.now) _J.prototype._time = function () { return performance.now(); }\n    function _initTimer() {\n        if (!_J.prototype._time) _J.prototype._time = function () { return Date.now(); }\n        _J.prototype._startTime = _J.prototype._time();\n        _J.prototype.time = function () { return _J.prototype._time() - _J.prototype._startTime; }\n    }\n\n    function _clone(obj, key, val) {\n        if (typeof key == 'undefined') return _clone(obj, [], []);\n        if (obj instanceof Object) {\n            for (var i = 0; i < key.length; i++) if (key[i] === obj) return val[i];\n            var ret;\n            if (obj instanceof Array) ret = []; else ret = {};\n            key.push(obj); val.push(ret);\n            for (var k in obj) if (obj.hasOwnProperty(k)) ret[k] = _clone(obj[k], key, val);\n            return ret;\n        }\n        return obj;\n    }\n    _J.prototype._info = { name: 'JZZ.js', ver: _version, version: _version };\n\n    var _outs = [];\n    var _ins = [];\n\n    function _postRefresh() {\n        this._info.engine = _engine._type;\n        this._info.version = _engine._version;\n        this._info.sysex = _engine._sysex;\n        this._info.inputs = [];\n        this._info.outputs = [];\n        _outs = [];\n        _ins = [];\n        _engine._allOuts = {};\n        _engine._allIns = {};\n        var i, x;\n        for (i = 0; i < _engine._outs.length; i++) {\n            x = _engine._outs[i];\n            x.engine = _engine;\n            _engine._allOuts[x.name] = x;\n            this._info.outputs.push({\n                name: x.name,\n                manufacturer: x.manufacturer,\n                version: x.version,\n                engine: _engine._type\n            });\n            _outs.push(x);\n        }\n        for (i = 0; i < _virtual._outs.length; i++) {\n            x = _virtual._outs[i];\n            this._info.outputs.push({\n                name: x.name,\n                manufacturer: x.manufacturer,\n                version: x.version,\n                engine: x.type\n            });\n            _outs.push(x);\n        }\n        for (i = 0; i < _engine._ins.length; i++) {\n            x = _engine._ins[i];\n            x.engine = _engine;\n            _engine._allIns[x.name] = x;\n            this._info.inputs.push({\n                name: x.name,\n                manufacturer: x.manufacturer,\n                version: x.version,\n                engine: _engine._type\n            });\n            _ins.push(x);\n        }\n        for (i = 0; i < _virtual._ins.length; i++) {\n            x = _virtual._ins[i];\n            this._info.inputs.push({\n                name: x.name,\n                manufacturer: x.manufacturer,\n                version: x.version,\n                engine: x.type\n            });\n            _ins.push(x);\n        }\n    }\n    function _refresh() {\n        this._slip(_postRefresh, []);\n        _engine._refresh();\n    }\n    _J.prototype.refresh = function () {\n        this._push(_refresh, []);\n        return this;\n    }\n\n    function _filterList(q, arr) {\n        if (typeof q == 'undefined') return arr.slice();\n        var i, n;\n        var a = [];\n        if (q instanceof RegExp) {\n            for (n = 0; n < arr.length; n++) if (q.test(arr[n].name)) a.push(arr[n]);\n            return a;\n        }\n        if (q instanceof Function) q = q(arr);\n        if (!(q instanceof Array)) q = [q];\n        for (i = 0; i < q.length; i++) {\n            for (n = 0; n < arr.length; n++) {\n                if (q[i] + '' === n + '' || q[i] === arr[n].name || (q[i] instanceof Object && q[i].name === arr[n].name)) a.push(arr[n]);\n            }\n        }\n        return a;\n    }\n\n    function _notFound(port, q) {\n        var msg;\n        if (q instanceof RegExp) msg = 'Port matching ' + q + ' not found';\n        else if (q instanceof Object || typeof q == 'undefined') msg = 'Port not found';\n        else msg = 'Port \"' + q + '\" not found';\n        port._crash(msg);\n    }\n\n    function _openMidiOut(port, arg) {\n        var arr = _filterList(arg, _outs);\n        if (!arr.length) { _notFound(port, arg); return; }\n        function pack(x) { return function () { x.engine._openOut(this, x.name); }; }\n        for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n        port._slip(_tryAny, [arr]);\n        port._resume();\n    }\n    _J.prototype.openMidiOut = function (arg) {\n        var port = new _M();\n        this._push(_refresh, []);\n        this._push(_openMidiOut, [port, arg]);\n        return port;\n    }\n\n    function _openMidiIn(port, arg) {\n        var arr = _filterList(arg, _ins);\n        if (!arr.length) { _notFound(port, arg); return; }\n        function pack(x) { return function () { x.engine._openIn(this, x.name); }; }\n        for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n        port._slip(_tryAny, [arr]);\n        port._resume();\n    }\n    _J.prototype.openMidiIn = function (arg) {\n        var port = new _M();\n        this._push(_refresh, []);\n        this._push(_openMidiIn, [port, arg]);\n        return port;\n    }\n\n    _J.prototype._close = function () {\n        _engine._close();\n    }\n\n    // _M: MIDI-In/Out object\n    function _M() {\n        _R.apply(this);\n        this._handles = [];\n        this._outs = [];\n    }\n    _M.prototype = new _R();\n\n    _M.prototype._receive = function (msg) { this._emit(msg); } // override!\n    function _receive(msg) { this._receive(msg); }\n    _M.prototype.send = function () {\n        this._push(_receive, [MIDI.apply(null, arguments)]);\n        return this;\n    }\n    _M.prototype.note = function (c, n, v, t) {\n        this.noteOn(c, n, v);\n        if (t) this.wait(t).noteOff(c, n);\n        return this;\n    }\n    _M.prototype._emit = function (msg) {\n        for (var i = 0; i < this._handles.length; i++) this._handles[i].apply(this, [MIDI(msg)._stamp(this)]);\n        for (var i = 0; i < this._outs.length; i++) {\n            var m = MIDI(msg);\n            if (!m._stamped(this._outs[i])) this._outs[i].send(m._stamp(this));\n        }\n    }\n    function _emit(msg) { this._emit(msg); }\n    _M.prototype.emit = function (msg) {\n        this._push(_emit, [msg]);\n        return this;\n    }\n    function _connect(arg) {\n        if (arg instanceof Function) _push(this._orig._handles, arg);\n        else _push(this._orig._outs, arg);\n    }\n    function _disconnect(arg) {\n        if (arg instanceof Function) _pop(this._orig._handles, arg);\n        else _pop(this._orig._outs, arg);\n    }\n    _M.prototype.connect = function (arg) {\n        this._push(_connect, [arg]);\n        return this;\n    }\n    _M.prototype.disconnect = function (arg) {\n        this._push(_disconnect, [arg]);\n        return this;\n    }\n\n    var _jzz;\n    var _engine = {};\n    var _virtual = { _outs: [], _ins: [] };\n\n    // Node.js\n    function _tryNODE() {\n        if (typeof module != 'undefined' && module.exports) {\n            _initNode(require('jazz-midi'));\n            return;\n        }\n        this._break();\n    }\n    // Jazz-Plugin\n    function _tryJazzPlugin() {\n        var div = document.createElement('div');\n        div.style.visibility = 'hidden';\n        document.body.appendChild(div);\n        var obj = document.createElement('object');\n        obj.style.visibility = 'hidden';\n        obj.style.width = '0px'; obj.style.height = '0px';\n        obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n        obj.type = 'audio/x-jazz';\n        document.body.appendChild(obj);\n        if (obj.isJazz) {\n            _initJazzPlugin(obj);\n            return;\n        }\n        this._break();\n    }\n    // Web-extension\n    function _tryCRX() {\n        var self = this;\n        var inst;\n        var msg;\n        function eventHandle(e) {\n            inst = true;\n            if (!msg) msg = document.getElementById('jazz-midi-msg');\n            if (!msg) return;\n            var a = [];\n            try { a = JSON.parse(msg.innerText); } catch (e) { }\n            msg.innerText = '';\n            document.removeEventListener('jazz-midi-msg', eventHandle);\n            if (a[0] === 'version') {\n                _initCRX(msg, a[2]);\n                self._resume();\n            }\n            else {\n                self._crash();\n            }\n        }\n        this._pause();\n        document.addEventListener('jazz-midi-msg', eventHandle);\n        try { document.dispatchEvent(new Event('jazz-midi')); } catch (e) { }\n        window.setTimeout(function () { if (!inst) self._crash(); }, 0);\n    }\n\n    function _zeroBreak() {\n        this._pause();\n        var self = this;\n        setTimeout(function () { self._crash(); }, 0);\n    }\n\n    function _filterEngines(opt) {\n        var ret = [_tryNODE, _zeroBreak];\n        var arr = _filterEngineNames(opt);\n        for (var i = 0; i < arr.length; i++) {\n            if (arr[i] == 'extension') ret.push(_tryCRX);\n            else if (arr[i] == 'plugin') ret.push(_tryJazzPlugin);\n        }\n        ret.push(_initNONE);\n        return ret;\n    }\n\n    function _filterEngineNames(opt) {\n        var web = ['plugin', 'extension'];\n        if (!opt || !opt.engine) return web;\n        var arr = opt.engine instanceof Array ? opt.engine : [opt.engine];\n        var dup = {};\n        var none;\n        var etc;\n        var head = [];\n        var tail = [];\n        for (var i = 0; i < arr.length; i++) {\n            var name = arr[i].toString().toLowerCase();\n            if (dup[name]) continue;\n            dup[name] = true;\n            if (name === 'none') none = true;\n            if (name === 'etc') etc = true;\n            if (etc) tail.push(name); else head.push(name);\n            _pop(web, name);\n        }\n        if (etc || head.length || tail.length) none = false;\n        return none ? [] : head.concat(etc ? web : tail);\n    }\n\n    function _initJZZ(opt) {\n        _jzz = new _J();\n        _jzz._options = opt;\n        _jzz._push(_tryAny, [_filterEngines(opt)]);\n        _jzz.refresh();\n        _jzz._push(_initTimer, []);\n        _jzz._push(function () { if (!_outs.length && !_ins.length) this._break(); }, []);\n        _jzz._resume();\n    }\n\n    function _initNONE() {\n        _engine._type = 'none';\n        _engine._sysex = true;\n        _engine._refresh = function () { _engine._outs = []; _engine._ins = []; }\n    }\n    // common initialization for Jazz-Plugin and jazz-midi\n    function _initEngineJP() {\n        _engine._inArr = [];\n        _engine._outArr = [];\n        _engine._inMap = {};\n        _engine._outMap = {};\n        _engine._version = _engine._main.version;\n        _engine._sysex = true;\n        _engine._refresh = function () {\n            _engine._outs = [];\n            _engine._ins = [];\n            var i, x;\n            for (i = 0; (x = _engine._main.MidiOutInfo(i)).length; i++) {\n                _engine._outs.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\n            }\n            for (i = 0; (x = _engine._main.MidiInInfo(i)).length; i++) {\n                _engine._ins.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\n            }\n        }\n        _engine._openOut = function (port, name) {\n            var impl = _engine._outMap[name];\n            if (!impl) {\n                if (_engine._pool.length <= _engine._outArr.length) _engine._pool.push(_engine._newPlugin());\n                impl = {\n                    name: name,\n                    clients: [],\n                    info: {\n                        name: name,\n                        manufacturer: _engine._allOuts[name].manufacturer,\n                        version: _engine._allOuts[name].version,\n                        type: 'MIDI-out',\n                        sysex: _engine._sysex,\n                        engine: _engine._type\n                    },\n                    _close: function (port) { _engine._closeOut(port); },\n                    _receive: function (a) { this.plugin.MidiOutRaw(a.slice()); }\n                };\n                var plugin = _engine._pool[_engine._outArr.length];\n                impl.plugin = plugin;\n                _engine._outArr.push(impl);\n                _engine._outMap[name] = impl;\n            }\n            if (!impl.open) {\n                var s = impl.plugin.MidiOutOpen(name);\n                if (s !== name) {\n                    if (s) impl.plugin.MidiOutClose();\n                    port._break(); return;\n                }\n                impl.open = true;\n            }\n            port._orig._impl = impl;\n            _push(impl.clients, port._orig);\n            port._info = impl.info;\n            port._receive = function (arg) { impl._receive(arg); }\n            port._close = function () { impl._close(this); }\n        }\n        _engine._openIn = function (port, name) {\n            var impl = _engine._inMap[name];\n            if (!impl) {\n                if (_engine._pool.length <= _engine._inArr.length) _engine._pool.push(_engine._newPlugin());\n                impl = {\n                    name: name,\n                    clients: [],\n                    info: {\n                        name: name,\n                        manufacturer: _engine._allIns[name].manufacturer,\n                        version: _engine._allIns[name].version,\n                        type: 'MIDI-in',\n                        sysex: _engine._sysex,\n                        engine: _engine._type\n                    },\n                    _close: function (port) { _engine._closeIn(port); },\n                    handle: function (t, a) {\n                        for (var i = 0; i < this.clients.length; i++) {\n                            var msg = MIDI(a);\n                            this.clients[i]._emit(msg);\n                        }\n                    }\n                };\n                function makeHandle(x) { return function (t, a) { x.handle(t, a); }; }\n                impl.onmidi = makeHandle(impl);\n                var plugin = _engine._pool[_engine._inArr.length];\n                impl.plugin = plugin;\n                _engine._inArr.push(impl);\n                _engine._inMap[name] = impl;\n            }\n            if (!impl.open) {\n                var s = impl.plugin.MidiInOpen(name, impl.onmidi);\n                if (s !== name) {\n                    if (s) impl.plugin.MidiInClose();\n                    port._break(); return;\n                }\n                impl.open = true;\n            }\n            port._orig._impl = impl;\n            _push(impl.clients, port._orig);\n            port._info = impl.info;\n            port._close = function () { impl._close(this); }\n        }\n        _engine._closeOut = function (port) {\n            var impl = port._impl;\n            _pop(impl.clients, port._orig);\n            if (!impl.clients.length) {\n                impl.open = false;\n                impl.plugin.MidiOutClose();\n            }\n        }\n        _engine._closeIn = function (port) {\n            var impl = port._impl;\n            _pop(impl.clients, port._orig);\n            if (!impl.clients.length) {\n                impl.open = false;\n                impl.plugin.MidiInClose();\n            }\n        }\n        _engine._close = function () {\n            for (var i = 0; i < _engine._inArr.length; i++) if (_engine._inArr[i].open) _engine._inArr[i].plugin.MidiInClose();\n        }\n        _J.prototype._time = function () { return _engine._main.Time(); }\n    }\n\n    function _initNode(obj) {\n        _engine._type = 'node';\n        _engine._main = obj;\n        _engine._pool = [];\n        _engine._newPlugin = function () { return new obj.MIDI(); }\n        _initEngineJP();\n    }\n    function _initJazzPlugin(obj) {\n        _engine._type = 'plugin';\n        _engine._main = obj;\n        _engine._pool = [obj];\n        _engine._newPlugin = function () {\n            var plg = document.createElement('object');\n            plg.style.visibility = 'hidden';\n            plg.style.width = '0px'; obj.style.height = '0px';\n            plg.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n            plg.type = 'audio/x-jazz';\n            document.body.appendChild(plg);\n            return plg.isJazz ? plg : undefined;\n        }\n        _initEngineJP();\n    }\n\n    function _initCRX(msg, ver) {\n        _engine._type = 'extension';\n        _engine._version = ver;\n        _engine._sysex = true;\n        _engine._pool = [];\n        _engine._inArr = [];\n        _engine._outArr = [];\n        _engine._inMap = {};\n        _engine._outMap = {};\n        _engine._msg = msg;\n        _engine._newPlugin = function () {\n            var plugin = { id: _engine._pool.length };\n            if (!plugin.id) plugin.ready = true;\n            else document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['new'] }));\n            _engine._pool.push(plugin);\n        }\n        _engine._newPlugin();\n        _engine._refresh = function () {\n            _engine._outs = [];\n            _engine._ins = [];\n            _jzz._pause();\n            document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['refresh'] }));\n        }\n        _engine._openOut = function (port, name) {\n            var impl = _engine._outMap[name];\n            if (!impl) {\n                if (_engine._pool.length <= _engine._outArr.length) _engine._newPlugin();\n                var plugin = _engine._pool[_engine._outArr.length];\n                impl = {\n                    name: name,\n                    clients: [],\n                    info: {\n                        name: name,\n                        manufacturer: _engine._allOuts[name].manufacturer,\n                        version: _engine._allOuts[name].version,\n                        type: 'MIDI-out',\n                        sysex: _engine._sysex,\n                        engine: _engine._type\n                    },\n                    _start: function () { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openout', plugin.id, name] })); },\n                    _close: function (port) { _engine._closeOut(port); },\n                    _receive: function (a) { var v = a.slice(); v.splice(0, 0, 'play', plugin.id); document.dispatchEvent(new CustomEvent('jazz-midi', { detail: v })); }\n                };\n                impl.plugin = plugin;\n                plugin.output = impl;\n                _engine._outArr.push(impl);\n                _engine._outMap[name] = impl;\n            }\n            port._orig._impl = impl;\n            _push(impl.clients, port._orig);\n            port._info = impl.info;\n            port._receive = function (arg) { impl._receive(arg); }\n            port._close = function () { impl._close(this); }\n            if (!impl.open) {\n                if (impl.plugin.ready) impl._start();\n                port._pause();\n            }\n        }\n        _engine._openIn = function (port, name) {\n            var impl = _engine._inMap[name];\n            if (!impl) {\n                if (_engine._pool.length <= _engine._inArr.length) _engine._newPlugin();\n                var plugin = _engine._pool[_engine._inArr.length];\n                impl = {\n                    name: name,\n                    clients: [],\n                    info: {\n                        name: name,\n                        manufacturer: _engine._allIns[name].manufacturer,\n                        version: _engine._allIns[name].version,\n                        type: 'MIDI-in',\n                        sysex: _engine._sysex,\n                        engine: _engine._type\n                    },\n                    _start: function () { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openin', plugin.id, name] })); },\n                    _close: function (port) { _engine._closeIn(port); }\n                };\n                impl.plugin = plugin;\n                plugin.input = impl;\n                _engine._inArr.push(impl);\n                _engine._inMap[name] = impl;\n            }\n            port._orig._impl = impl;\n            _push(impl.clients, port._orig);\n            port._info = impl.info;\n            port._close = function () { impl._close(this); }\n            if (!impl.open) {\n                if (impl.plugin.ready) impl._start();\n                port._pause();\n            }\n        }\n        _engine._closeOut = function (port) {\n            var impl = port._impl;\n            _pop(impl.clients, port._orig);\n            if (!impl.clients.length) {\n                impl.open = false;\n                document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closeout', impl.plugin.id] }));\n            }\n        }\n        _engine._closeIn = function (port) {\n            var impl = port._impl;\n            _pop(impl.clients, port._orig);\n            if (!impl.clients.length) {\n                impl.open = false;\n                document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closein', impl.plugin.id] }));\n            }\n        }\n        _engine._close = function () {\n        }\n        document.addEventListener('jazz-midi-msg', function (e) {\n            var v = _engine._msg.innerText.split('\\n');\n            _engine._msg.innerText = '';\n            for (var i = 0; i < v.length; i++) {\n                var a = [];\n                try { a = JSON.parse(v[i]); } catch (e) { }\n                if (!a.length) continue;\n                if (a[0] === 'refresh') {\n                    if (a[1].ins) {\n                        for (var j = 0; i < a[1].ins; i++) a[1].ins[j].type = _engine._type;\n                        _engine._ins = a[1].ins;\n                    }\n                    if (a[1].outs) {\n                        for (var j = 0; i < a[1].outs; i++) a[1].outs[j].type = _engine._type;\n                        _engine._outs = a[1].outs;\n                    }\n                    _jzz._resume();\n                }\n                else if (a[0] === 'version') {\n                    var plugin = _engine._pool[a[1]];\n                    if (plugin) {\n                        plugin.ready = true;\n                        if (plugin.input) plugin.input._start();\n                        if (plugin.output) plugin.output._start();\n                    }\n                }\n                else if (a[0] === 'openout') {\n                    var impl = _engine._pool[a[1]].output;\n                    if (impl) {\n                        if (a[2] == impl.name) {\n                            impl.open = true;\n                            if (impl.clients) for (var i = 0; i < impl.clients.length; i++) impl.clients[i]._resume();\n                        }\n                        else if (impl.clients) for (var i = 0; i < impl.clients.length; i++) impl.clients[i]._crash();\n                    }\n                }\n                else if (a[0] === 'openin') {\n                    var impl = _engine._pool[a[1]].input;\n                    if (impl) {\n                        if (a[2] == impl.name) {\n                            impl.open = true;\n                            if (impl.clients) for (var i = 0; i < impl.clients.length; i++) impl.clients[i]._resume();\n                        }\n                        else if (impl.clients) for (var i = 0; i < impl.clients.length; i++) impl.clients[i]._crash();\n                    }\n                }\n                else if (a[0] === 'midi') {\n                    var impl = _engine._pool[a[1]].input;\n                    if (impl && impl.clients) {\n                        for (var i = 0; i < impl.clients.length; i++) {\n                            var msg = MIDI(a.slice(3));\n                            impl.clients[i]._emit(msg);\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    var JZZ = function (opt) {\n        if (!_jzz) _initJZZ(opt);\n        return _jzz;\n    }\n    JZZ.info = function () { return _J.prototype.info(); }\n    return JZZ;\n}\n\nmodule.exports = createJzz();\n"]}